## GreenPrj 安全与配置检查清单（Web 单机版本）

本清单用于追踪当前阶段（本地优先 Web 版本）的安全与配置状态，后续若引入云端后端，可在此基础上扩展。

### 1. 配置与敏感信息

- [x] **前端代码中无硬编码真实秘钥 / Token / API Key**  
  - 检查范围：`web/src/**`、`web/tests/**`、根目录配置文件等。  
  - 仅存在用于测试的密码常量（如 `TEST_PASSWORD`），且仅用于本地自动化测试，不用于生产。

- [x] **示例环境变量不包含真实敏感值**  
  - 根 `README.md` 中示例 `DATABASE_URL=postgres://...` 为占位符，不包含真实连接串。  
  - `_bmad` 下关于 API_KEY / TOKEN 等内容，仅为 BMAD 模板与知识文档示例，不关联本项目实际部署。

- [x] **前端不依赖服务端密钥**  
  - 当前 Web 版本完全在浏览器本地运行，不调用远程后端接口，也未在构建配置中引用云端秘钥。

### 2. 本地加密与密码处理

- [x] **本地数据加密**  
  - 使用 `AES-256-GCM` + PBKDF2（100,000 次迭代）从用户密码派生密钥（见 `web/src/services/security/encryption.ts`）。  
  - 加盐（16 字节随机盐）与随机 IV 均按行业惯例生成并与密文一同存储。

- [x] **密码不明文存储**  
  - 用户密码用于推导加密密钥和本地会话管理，不以明文形式持久化。  
  - 测试用密码常量仅出现在 `tests` 目录，用于 E2E 与单元测试。

- [x] **会话管理**  
  - Web 版本实现了 30 分钟会话超时与自动登出逻辑（详见 `session-manager.ts` 与相关测试），避免长期空闲会话。

### 3. 构建与 CI 安全

- [x] **CI 不暴露敏感配置**  
  - `.github/workflows/ci.yml` 中仅执行 `npm ci` / `npm run lint` / `npm run build` / `npm run test:e2e`，未引用仓库 Secrets。  
  - 当前流水线不访问外部服务（如 Pact Broker、Mailosaur 等），相关示例仅存在于 `_bmad` 知识文档中。

- [x] **依赖安装策略**  
  - CI 优先使用 `npm ci`，失败时回退 `npm install`，确保锁文件与依赖一致性。  
  - 后续若引入后端或更多依赖，可增加 `npm audit` / `pnpm audit` 等安全扫描步骤。

### 4. 数据与隐私

- [x] **本地优先 / 单机模式说明**  
  - 根 `README.md` 与 `docs/USER_GUIDE.md` 中明确当前 Web 版本为本地单机，数据仅保存在浏览器 IndexedDB 中。  
  - 通过导入 / 导出 JSON/CSV 实现备份与迁移，由用户自行掌控数据文件。

- [x] **删除与备份流程**  
  - 在「数据管理」中提供数据导出与删除功能。  
  - 文档中提醒用户在清除数据或更换设备前先导出备份。

### 5. 后续安全工作（云端阶段预留）

以下项将在未来引入云后端或多端同步时重点关注：

- [ ] 后端认证与授权（JWT / Session / OAuth 等）的安全设计与实现。  
- [ ] 后端环境变量与秘钥管理（使用平台 Secret Manager，而非硬编码或 `.env` 提交）。  
- [ ] 依赖安全扫描（CI 中集成 `npm audit` / `pnpm audit` 或第三方 SCA 工具）。  
- [ ] 安全头部与浏览器安全策略（CSP、HSTS、X-Frame-Options 等）。  
- [ ] 日志与审计中避免记录敏感数据（如完整密码、完整卡号等）。  

> 当前阶段结论：在“本地单机 Web 版本，无真实后端”的前提下，代码库中未发现明显硬编码敏感信息或不安全配置；  
> 加密与会话逻辑已按计划实现，后续云端架构落地时需在此基础上扩展后端安全方案。


# Android ↔ Web 账本导出/导入闭环验证

**目标**：设计并验证 Android 与 Web 之间的账本导出/导入闭环，覆盖单向导出导入和双端合并去重。

---

## 典型场景

### 场景 1：Android 记账 → 导出 → Web 导入 → 查看统计

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 在 Android 端登录，进入「记账」，新增若干条账目（不同日期、类别、金额）。 | 列表中出现对应记录。 |
| 2 | 进入「合并」或数据管理入口，导出账本为 JSON 文件（与 Web 约定格式一致）。 | 得到 `.json` 文件，内含 `entries` 等字段。 |
| 3 | 在 Web 端登录，进入「数据管理」→「导入备份文件」，选择步骤 2 的 JSON。 | 导入前校验通过，确认后写入；可选冲突策略（覆盖/合并）。 |
| 4 | 在 Web 端「统计」页按时间/类别查看。 | 与 Android 中录入的条数、金额、类别一致；趋势图与类别分布正确。 |

**实际验证记录**：（待执行后填写：日期、结果是否与预期一致、异常说明。）

---

### 场景 2：Web 记账 → 导出 → Android 导入 → 查看列表

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 在 Web 端「记账」页新增若干条账目。 | 列表与统计中可见。 |
| 2 | 「数据管理」→ 导出 JSON。 | 下载的 JSON 符合 Web/Android 共用 schema。 |
| 3 | 在 Android 端进入「合并」或导入入口，选择步骤 2 的 JSON 文件。 | 解析与校验通过；可选「合并到当前账本」或「覆盖」。 |
| 4 | 在 Android「记账」列表及「统计」中查看。 | 与 Web 中录入的记录一致。 |

**实际验证记录**：（待执行后填写。）

---

### 场景 3：双端都有部分重复记录 → 合并去重与冲突解决

| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | Android 与 Web 各自先有若干条账目（可有意制造 1–2 条同金额、同日期、同类别的「重复」）。 | 两端的列表分别正确。 |
| 2 | 从一端导出 JSON，在另一端选择「合并导入」（不选「覆盖」）。 | 导入流程提供去重策略（如按 id 或 金额+日期+类别+备注 判定重复）。 |
| 3 | 执行合并。 | 重复项只保留一条；非重复项全部进入列表；若存在冲突（如同 id 不同内容），按产品规则保留其一或提示用户。 |
| 4 | 在两端分别查看列表与统计。 | 合并后总条数、总金额与预期一致；无重复条。 |

**实际验证记录**：（待执行后填写。）

---

## 数据格式约定

- 导出 JSON 需包含与 [docs/json-schema.md](json-schema.md) 或 Web 端 `ExportService` 一致的字段（如 `entries` 数组，每项含 `id`、`amount`、`date`、`category`、`notes` 等）。
- Android 端 `MergeRepository` / 导入逻辑需与 Web 端解析与去重规则对齐，以便上述三场景可复现。

---

## 验证状态

| 场景 | 设计完成 | 实际操作验证 | 记录日期 |
|------|----------|--------------|----------|
| 1. Android → Web → 统计 | ✅ | 待执行 | - |
| 2. Web → Android → 列表 | ✅ | 待执行 | - |
| 3. 双端合并去重 | ✅ | 待执行 | - |

完成实际操作后，请在上方各场景的「实际验证记录」中填写结果，并更新本表「实际操作验证」列为「已完成」。
